<html>
	<head>
		<title>Game</title>
		<script src="phaser.min.js"></script>
		<script>
			var P2Game = {};
			
			P2Game.StateA = function (game) {
				this.player;
				this.key1;
				this.key2;
				this.key3;
				
				this.jumpTimer = 0;
				
				this.tilesprite;
				this.bc;
				
				this.customOnFloor=false;
				
				this.arbolin;
				
				this.preload = function() {
					this.game.stage.backgroundColor = '#eee';
					this.game.load.spritesheet('player', 'SpriteBoy.png',14,32);
					this.game.load.image('grassfloor', 'floorgrass.png');
					this.game.load.image('BackGroundA', 'BackGroundA.png');
					this.game.load.image('Arbolin', 'Arbolin.png');
					
					//Arbolin.png
					
				}
				
				this.create = function() {
					this.game.physics.startSystem(Phaser.Physics.ARCADE);
					
					this.game.input.keyboard.removeKeyCapture(Phaser.Keyboard.LEFT);
					this.game.input.keyboard.removeKeyCapture(Phaser.Keyboard.RIGHT);
					this.game.input.keyboard.removeKeyCapture(Phaser.Keyboard.SPACEBAR);
					
					this.key1 = this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
					this.key2 = this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
					this.key3 = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
					
					this.bc=this.game.add.tileSprite(0,0,480,320,'BackGroundA');
					
					this.arbolin=this.game.add.sprite(100, 236, 'Arbolin');
					
					this.player = game.add.sprite(32, 32, 'player');
					this.game.physics.enable(this.player, Phaser.Physics.ARCADE);
					this.player.body.collideWorldBounds = true;
					this.player.body.gravity.y = 1000;
					this.player.body.maxVelocity.y = 500;
					
					this.player.animations.add('default', [0], 10, true);
					this.player.animations.add('left', [4, 5], 10, true);
					this.player.animations.add('right', [1, 2], 10, true);
					
					this.tilesprite=this.game.add.tileSprite(0, 300, 480, 20, 'grassfloor');
					this.game.physics.enable(this.tilesprite, Phaser.Physics.ARCADE);
					
					this.tilesprite.body.collideWorldBounds = true;
					this.tilesprite.body.immovable = true;
					this.tilesprite.body.allowGravity = false;
					
					//this.player.scale.setTo(this.player.scale.x*1.5,this.player.scale.y*1.5);
					
				}
				
				this.update=function() {
					game.physics.arcade.collide(this.player, this.tilesprite, this.customOnFloorFunction,null,this);
					this.player.body.velocity.x = 0;
					if (this.key1.isDown){
						this.player.animations.play('left');
						this.player.body.velocity.x = -150;
					}
					else if (this.key2.isDown){
						this.player.animations.play('right');
						this.player.body.velocity.x = 150;
					}
					else {
						this.player.animations.play('default');
					}
					if (this.key3.isDown && this.customOnFloor && game.time.now > this.jumpTimer){ //  this.player.body.onFloor()
						this.player.body.velocity.y = -250;
						this.jumpTimer = game.time.now + 750;
					}
				}
				
				this.customOnFloorFunction = function(obj1,obj2){
					if(obj1.body.touching.down){
						this.customOnFloor=true;
					}
					else{
						this.customOnFloor=false;
					}
				}
				
				
			}
			
			var game = new Phaser.Game(480, 320, Phaser.AUTO, 'GameArea');

			game.state.add('StateA', P2Game.StateA);

			game.state.start('StateA');
		</script>
	</head>
	<body>
		<p>Mover con botones derecha, izquierda</p>
		<p>Brincar con tecla de espacio</p>
	</body>
</html>